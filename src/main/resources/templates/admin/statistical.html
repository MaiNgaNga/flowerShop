<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Thống Kê Cửa Hàng Hoa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f6fa;
            font-size: 14px;
        }

        .stats-container {
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            gap: 25px;
            flex-wrap: nowrap;
            width: 100%;
            max-width: 1200px;
        }

        .card {
            width: 250px;
            height: 180px;
            background: linear-gradient(135deg, #ffffff 0%, #eef2f7 100%);
            border-radius: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            bottom: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%);
            z-index: 0;
        }

        .card-content {
            position: relative;
            z-index: 1;
        }

        .number {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .label {
            font-size: 14px;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1.2px;
        }

        .card.blue { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); }
        .card.green { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); }
        .card.pink { background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%); }
        .card.orange { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); }

        .card.blue .number, .card.green .number, .card.pink .number, .card.orange .number { color: #ffffff; }
        .card.blue .label, .card.green .label, .card.pink .label, .card.orange .label { color: #ecf0f1; }

        .chart-card {
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            padding: 20px;
            margin-top: 30px;
        }
    </style>
</head>
<body>

<!-- Bộ lọc tháng năm -->
<div class="filter-container mb-3 d-flex justify-content-center gap-2">
    <select id="yearSelect" class="form-select w-auto">
       
        <option value="2024" th:selected="${selectedYear == 2024}">2024</option>
        <option value="2025" th:selected="${selectedYear == 2025}">2025</option>
    </select>

    <select id="monthSelect" class="form-select w-auto">
        <option value="1" th:selected="${selectedMonth == 1}">Tháng 1</option>
        <option value="2" th:selected="${selectedMonth == 2}">Tháng 2</option>
        <option value="3" th:selected="${selectedMonth == 3}">Tháng 3</option>
        <option value="4" th:selected="${selectedMonth == 4}">Tháng 4</option>
        <option value="5" th:selected="${selectedMonth == 5}">Tháng 5</option>
        <option value="6" th:selected="${selectedMonth == 6}">Tháng 6</option>
        <option value="7" th:selected="${selectedMonth == 7}">Tháng 7</option>
        <option value="8" th:selected="${selectedMonth == 8}">Tháng 8</option>
        <option value="9" th:selected="${selectedMonth == 9}">Tháng 9</option>
        <option value="10" th:selected="${selectedMonth == 10}">Tháng 10</option>
        <option value="11" th:selected="${selectedMonth == 11}">Tháng 11</option>
        <option value="12" th:selected="${selectedMonth == 12}">Tháng 12</option>
    </select>
</div>

<!-- 4 Thẻ thống kê -->
<center>
    <div class="stats-container">
        <div class="card blue">
            <div class="card-content">
                <div class="number" id="totalRevenue" th:text="${#numbers.formatDecimal(totalRevenue, 0, 'COMMA', 0, 'POINT')} + ' đ'"></div>
                <div class="label">Tổng doanh thu trong năm [[${selectedYear}]]</div>
            </div>
        </div>
        <div class="card green">
            <div class="card-content">
                <div class="number" id="canceledOrders" th:text="${canceledOrders}">0</div>
                <div class="label">Đơn hủy trong tháng</div>
            </div>
        </div>
        <div class="card pink">
            <div class="card-content">
                <div class="number" id="totalOrders" th:text="${totalOrders}">0</div>
                <div class="label">Số lượng đơn đặt hàng trong tháng</div>
            </div>
        </div>
        <!-- <div class="card orange">
            <div class="card-content">
                <div class="number" id="totalServices">0</div>
                <div class="label">Số lượng dịch vụ trong tháng</div>
            </div>
        </div> -->
    </div>
</center>

<!-- Biểu đồ xu hướng doanh số -->
<div class="container">
    <div class="row">
        <div class="col-md-8 mb-4">
            <div class="chart-card">
                <h2 class="text-center">Xu hướng doanh số</h2>
                <canvas id="lineChart"></canvas>
            </div>
        </div>
        <!-- <div class="col-md-4 mb-4">
            <div class="chart-card">
                <h2 class="text-center">Tỷ lệ doanh thu</h2>
                <canvas id="pieChart"></canvas>
            </div>
        </div> -->
    </div>
</div>

<!-- Script xử lý -->
<script>
    const dataByYearMonth = {
        2023: {
            1: { bestCategory: 40, canceledOrders: 15, totalOrders: 8, totalServices: 4, lineData: [45, 55, 65, 60, 75, 85, 80, 90, 95, 100, 95, 110], pieData: [28, 22, 25, 25] },
            2: { bestCategory: 42, canceledOrders: 16, totalOrders: 9, totalServices: 5, lineData: [50, 60, 70, 65, 80, 90, 85, 95, 100, 110, 105, 120], pieData: [30, 25, 20, 25] },
        },
        2024: {
            1: { bestCategory: 43, canceledOrders: 18, totalOrders: 10, totalServices: 6, lineData: [55, 65, 75, 70, 85, 95, 90, 100, 105, 115, 110, 125], pieData: [32, 23, 22, 23] },
        },
        2025: {
            1: { bestCategory: 45, canceledOrders: 20, totalOrders: 10, totalServices: 5, lineData: [50, 60, 70, 65, 80, 90, 85, 95, 100, 110, 105, 120], pieData: [30, 25, 20, 25] },
        }
    };

    const pieChart = new Chart(document.getElementById('pieChart'), {
        type: 'pie',
        data: {
            labels: ['Sản phẩm A', 'Sản phẩm B', 'Sản phẩm C', 'Sản phẩm D'],
            datasets: [{
                data: [30, 25, 20, 25],
                backgroundColor: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4'],
                borderColor: ['#fff'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { font: { size: 10 }, color: '#333' }
                }
            }
        }
    });

    const lineChart = new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6', 'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'],
            datasets: [{
                label: 'Doanh số',
                data: [50, 60, 70, 65, 80, 90, 85, 95, 100, 110, 105, 120],
                borderColor: '#FF6B6B',
                backgroundColor: 'rgba(255, 107, 107, 0.2)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { font: { size: 12 }, color: '#333' }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: 'Triệu VNĐ', font: { size: 12 }, color: '#333' },
                    ticks: { font: { size: 12 }, color: '#333' }
                },
                x: {
                    ticks: { font: { size: 12 }, color: '#333' }
                }
            }
        }
    });

    function updateDashboard(year, month) {
        const data = (dataByYearMonth[year] && dataByYearMonth[year][month]) || {
            bestCategory: 0,
            canceledOrders: 0,
            totalOrders: 0,
            totalServices: 0,
            lineData: Array(12).fill(0),
            pieData: [0, 0, 0, 0]
        };

        document.getElementById('canceledOrders').textContent = data.canceledOrders;
        document.getElementById('totalOrders').textContent = data.totalOrders;
        document.getElementById('totalServices').textContent = data.totalServices;

        lineChart.data.datasets[0].data = data.lineData;
        lineChart.update();

        pieChart.data.datasets[0].data = data.pieData;
        pieChart.update();
    }

    document.getElementById('monthSelect').addEventListener('change', function () {
        const year = document.getElementById('yearSelect').value;
        const month = this.value;
        updateDashboard(year, month);
    });

    document.getElementById('yearSelect').addEventListener('change', function () {
        const year = this.value;
        const month = document.getElementById('monthSelect').value;
        updateDashboard(year, month);
    });
</script>
</body>
</html>


<main class="container mt-4">
  <h2 class="mb-4">Qu·∫£n L√Ω B√°n H√†ng T·∫°i Qu·∫ßy</h2>
  <div class="card mb-3 p-3">
    <form method="get" class="row g-3 align-items-end">
      <div class="col-md-3">
        <label for="fromDate" class="form-label">T·ª´ ng√†y:</label>
        <input type="date" class="form-control" id="fromDate" name="fromDate" th:value="${fromDate}"  />
      </div>
      <div class="col-md-3">
        <label for="toDate" class="form-label">ƒê·∫øn ng√†y:</label>
        <input type="date" class="form-control" id="toDate" name="toDate" th:value="${toDate}" />
      </div>
      <div class="col-md-3">
        <label for="orderCode" class="form-label">T√¨m theo m√£ ƒë∆°n:</label>
        <input type="text" class="form-control" id="orderCode" name="orderCode" placeholder="Nh·∫≠p m√£ ƒë∆°n h√†ng" th:value="${orderCode}" />
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary">L·ªçc</button>
        <a href="/admin/pos/index" class="btn btn-secondary ms-2">L√†m m·ªõi</a>
      </div>
    </form>
  </div>
  <div class="card p-3">
    <ul class="nav nav-tabs mb-3" id="posTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="list-tab" data-bs-toggle="tab" data-bs-target="#list" type="button" role="tab" aria-controls="list" aria-selected="true">Danh s√°ch ƒë∆°n h√†ng</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="detail-tab" data-bs-toggle="tab" data-bs-target="#detail" type="button" role="tab" aria-controls="detail" aria-selected="false">Chi ti·∫øt ƒë∆°n h√†ng</button>
      </li>
    </ul>
    <div class="tab-content" id="posTabContent">
            <!-- Tab Danh s√°ch -->
            <div
              class="tab-pane fade show active"
              id="list"
              role="tabpanel"
              aria-labelledby="list-tab"
            >
              <div class="card">
                <div class="table-responsive">
                  <table class="table table-bordered table-hover align-middle">
                    <thead class="table-dark">
                      <tr>
                        <th>ID</th>
                        <th>M√£ ƒë∆°n</th>
                        <th>T·ªïng ti·ªÅn</th>
                        <th>Ng√†y b√°n</th>

                        <th>PT Thanh to√°n</th>
                        <th>Tr·∫°ng th√°i TT</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>Thao t√°c</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr th:each="order : ${orders.content}">
                      <td th:text="${order.id}"></td>
                      <td th:text="${order.orderCode}"></td>
                      <td th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' VND'"></td>
                      <td th:text="${#dates.format(order.createDate, 'dd/MM/yyyy')}"></td>
                      <td>
                        <span 
                          th:class="${order.paymentMethod == 'CASH'} ? 'badge bg-success' : 'badge bg-primary'"
                          th:text="${order.paymentMethod == 'CASH'} ? 'üíµ Ti·ªÅn m·∫∑t' : 'üè¶ Chuy·ªÉn kho·∫£n'"
                        ></span>
                      </td>
                      <td>
                        <span 
                          th:class="${order.paymentStatus == 'ƒê√£ thanh to√°n'} ? 'badge bg-success' : 'badge bg-warning'"
                          th:text="${order.paymentStatus}"
                        ></span>
                      </td>
                      <td>
                        <span 
                          th:class="${order.status == 'Ho√†n t·∫•t'} ? 'badge bg-success' : 'badge bg-warning'"
                          th:text="${order.status}"
                        ></span>
                      </td>

                      <td>
                        <a th:href="@{/admin/pos/index(orderId=${order.id})}" class="btn btn-sm btn-info">Chi ti·∫øt</a>
                        <a 
                          th:if="${order.status == 'Ch·ªù thanh to√°n'}"
                          th:href="@{/pos/payment-qr(orderCode=${order.orderCode})}"
                          class="btn btn-sm btn-warning ms-1"
                          target="_blank"
                        >
                          Thanh to√°n l·∫°i
                        </a>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <!-- Pagination: ch·ªâ hi·ªÉn th·ªã m·ªôt l·∫ßn sau b·∫£ng -->
                <div class="d-flex justify-content-center mt-3">
      <div class="d-flex justify-content-center mt-3" th:if="${totalPages > 0}">
        <nav>
          <ul class="pagination custom-pagination">
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
              <a class="page-link" th:href="@{/admin/pos/index(page=0, size=${size}, productCategoryId=${productCategoryId}, keyword=${keyword}, tab='list')}">
                <i class="fa fa-angle-double-left"></i>
              </a>
            </li>
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
              <a class="page-link" th:href="@{/admin/pos/index(page=${currentPage - 1}, size=${size}, productCategoryId=${productCategoryId}, keyword=${keyword}, tab='list')}">
                <i class="fa fa-angle-left"></i>
              </a>
            </li>
            <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}" th:classappend="${currentPage == i} ? 'active'">
              <a class="page-link" th:href="@{/admin/pos/index(page=${i}, size=${size}, productCategoryId=${productCategoryId}, keyword=${keyword}, tab='list')}" th:text="${i + 1}"></a>
            </li>
            <li class="page-item" th:classappend="${currentPage + 1 == totalPages} ? 'disabled'">
              <a class="page-link" th:href="@{/admin/pos/index(page=${currentPage + 1}, size=${size}, productCategoryId=${productCategoryId}, keyword=${keyword}, tab='list')}">
                <i class="fa fa-angle-right"></i>
              </a>
            </li>
            <li class="page-item" th:classappend="${currentPage + 1 == totalPages} ? 'disabled'">
              <a class="page-link" th:href="@{/admin/pos/index(page=${totalPages - 1}, size=${size}, productCategoryId=${productCategoryId}, keyword=${keyword}, tab='list')}">
                <i class="fa fa-angle-double-right"></i>
              </a>
            </li>
          </ul>
        </nav>
      </div>
                </div>
                      </tr>
                      <tr th:if="${#lists.isEmpty(orders)}">
                        <td colspan="8" class="text-center text-muted">
                          Hi·ªán ch∆∞a c√≥ ƒë∆°n h√†ng n√†o t·∫°i qu·∫ßy.
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <!-- Tab Chi ti·∫øt -->
            <div
              class="tab-pane fade"
              id="detail"
              role="tabpanel"
              aria-labelledby="detail-tab"
            >
              <div th:if="${orderDetail != null}">
                <div class="card mb-3 p-3">
                  <h5>Th√¥ng tin ƒë∆°n h√†ng</h5>
                  <div class="row mb-2">
                    <div class="col-md-4">
                      <b>M√£ ƒë∆°n:</b> <span th:text="${orderDetail.orderCode}"></span>
                    </div>
                    <div class="col-md-4">
                      <b>Ng√†y b√°n:</b>
                      <span
                        th:text="${#dates.format(orderDetail.createDate, 'dd/MM/yyyy')}"
                      ></span>
                    </div>
                    <div class="col-md-4">
                      <b>Tr·∫°ng th√°i:</b>
                      <span 
                        th:class="${orderDetail.status == 'Ho√†n t·∫•t'} ? 'badge bg-success' : 'badge bg-warning'"
                        th:text="${orderDetail.status}"
                      ></span>
                    </div>
                  </div>
                  <div class="row mb-2">
                    <div class="col-md-6">
                      <b>Ph∆∞∆°ng th·ª©c thanh to√°n:</b>
                      <span 
                        th:class="${orderDetail.paymentMethod == 'CASH'} ? 'badge bg-success' : 'badge bg-primary'"
                        th:text="${orderDetail.paymentMethod == 'CASH'} ? 'üíµ Ti·ªÅn m·∫∑t' : 'üè¶ Chuy·ªÉn kho·∫£n'"
                      ></span>
                    </div>
                    <div class="col-md-6">
                      <b>Tr·∫°ng th√°i thanh to√°n:</b>
                      <span 
                        th:class="${orderDetail.paymentStatus == 'ƒê√£ thanh to√°n'} ? 'badge bg-success' : 'badge bg-warning'"
                        th:text="${orderDetail.paymentStatus}"
                      ></span>
                    </div>
                  </div>
                </div>
                <div class="card">
                  <div class="table-responsive">
                    <table
                      class="table table-bordered table-hover align-middle"
                    >
                      <thead class="table-light">
                        <tr>
                          <th>#</th>
                          <th>T√™n s·∫£n ph·∫©m</th>
                          <th>S·ªë l∆∞·ª£ng</th>
                          <th>ƒê∆°n gi√°</th>
                          <th>Th√†nh ti·ªÅn</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr th:each="item,iter : ${orderDetail.orderDetails}">
                          <td th:text="${iter.index + 1}"></td>
                          <td th:text="${item.product.name}"></td>
                          <td th:text="${item.quantity}"></td>
                          <td
                            th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + ' VND'"
                          ></td>
                          <td
                            th:text="${#numbers.formatDecimal(item.price * item.quantity, 0, 'COMMA', 0, 'POINT')} + ' VND'"
                          ></td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(orderDetail.orderDetails)}">
                          <td colspan="5" class="text-center text-muted">
                            Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o trong ƒë∆°n h√†ng n√†y.
                          </td>
                        </tr>
                      </tbody>
                      <tfoot>
                        <tr>
                          <td colspan="4" class="text-end fw-bold">
                            T·ªïng ti·ªÅn:
                          </td>
                          <td
                            class="fw-bold text-danger"
                            th:text="${#numbers.formatDecimal(orderDetail.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' VND'"
                          ></td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </div>
              </div>
              <div
                th:if="${orderDetail == null}"
                class="text-center text-muted mt-4"
              >
                Vui l√≤ng ch·ªçn ƒë∆°n h√†ng ƒë·ªÉ xem chi ti·∫øt.
              </div>
            </div>
          </div>
        </div>
      </div>
  </div>
<!-- Hi·ªÉn th·ªã th√¥ng b√°o flash messages t·ª´ controller -->
<div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
  <span th:text="${success}"></span>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>

<div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
  <span th:text="${error}"></span>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>

<div th:if="${warning}" class="alert alert-warning alert-dismissible fade show" role="alert">
  <span th:text="${warning}"></span>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>

<script th:inline="javascript">
    var hasOrderDetail = /*[[${orderDetail != null}]]*/ false;
    if (hasOrderDetail) {
        var detailTab = document.getElementById('detail-tab');
        if (detailTab) {
            detailTab.click();
        }
    }
  </script>
<script src="/js/posCRUD.js"></script>
</main>


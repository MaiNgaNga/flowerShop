<link
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
  rel="stylesheet"
/>
<style>
  .accordion-button::after {
    display: none !important;
  }
</style>
<div class=" ">
  <h4 class="mb-4">Qu·∫£n L√Ω ƒë∆°n h√†ng online</h4>
  <div class="card mb-3 p-3">
    <form
      method="get"
      th:action="@{/orderAdmin}"
      class="row g-3 align-items-end"
    >
      <div class="col-md-2">
        <label for="" class="form-label">Tr·∫°ng th√°i</label>

        <select
          class="form-control form-select-sm"
          name="orderStatus"
          aria-label="L·ªçc ƒë∆°n h√†ng"
        >
          <option value="">--T·∫•t c·∫£--</option>

          <option
            value="Ch·ªù x√°c nh·∫≠n"
            th:selected="${orderStatus == 'Ch·ªù x√°c nh·∫≠n'}"
          >
            Ch·ªù x√°c nh·∫≠n
          </option>
          <option value="Ch·ªù giao" th:selected="${orderStatus == 'Ch·ªù giao'}">
            Ch·ªù giao
          </option>
          <option value="ƒêang giao" th:selected="${orderStatus == 'ƒêang giao'}">
            ƒêang giao
          </option>
          <option value="Ho√†n t·∫•t" th:selected="${orderStatus == 'Ho√†n t·∫•t'}">
            Ho√†n t·∫•t
          </option>
          <option value="ƒê√£ h·ªßy" th:selected="${orderStatus == 'ƒê√£ h·ªßy'}">
            ƒê√£ h·ªßy
          </option>
          <option
            value="Giao th·∫•t b·∫°i"
            th:selected="${orderStatus == 'Giao th·∫•t b·∫°i'}"
          >
            Giao th·∫•t b·∫°i
          </option>

          <option
            value="ƒêang giao l·∫°i"
            th:selected="${orderStatus == 'ƒêang giao l·∫°i'}"
          >
            ƒêang giao l·∫°i
          </option>
        </select>
      </div>
      <div class="col-md-2">
        <label for="fromDate" class="form-label">T·ª´ ng√†y</label>
        <input
          type="date"
          class="form-control"
          id="from"
          name="fromDate"
          th:value="${fromDate}"
        />
      </div>
      <div class="col-md-2">
        <label for="toDate" class="form-label">ƒê·∫øn ng√†y</label>
        <input
          type="date"
          class="form-control"
          id="to"
          name="toDate"
          th:value="${toDate}"
        />
      </div>
      <div class="col-md-3">
        <label for="keyword" class="form-label">T√¨m ki·∫øm</label>
        <input
          type="text"
          class="form-control"
          id="keyword"
          name="keyword"
          placeholder="Nh·∫≠p m√£, t√™n ho·∫∑c sdt"
          th:value="${keyword}"
        />
      </div>
      <div class="col-md-3 filter-buttons">
        <button type="submit" class="btn btn-primary btn-action" title="L·ªçc">
          <i class="bi bi-funnel"></i>
        </button>
        <a
          type="button"
          href="/orderAdmin"
          class="btn btn-secondary btn-action"
        >
          <i class="bi bi-x-circle"></i>
        </a>
      </div>
    </form>
  </div>

  <div class="accordion" id="orderHistory" style="width: 100%">
    <!-- L·∫∑p qua danh s√°ch ƒë∆°n h√†ng -->
    <div
      class="accordion-item"
      th:each="order, iterStat : ${orders}"
      style="
        border: 1px solid #e9ecef;
        border-radius: 0.25rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      "
    >
      <h2 class="accordion-header" th:id="'heading' + ${iterStat.index}">
        <button
          class="accordion-button collapsed bg-light d-flex justify-content-between align-items-center"
          type="button"
          data-bs-toggle="collapse"
          th:attr="data-bs-target='#order' + ${iterStat.index}"
          style="font-weight: 500; color: #333"
        >
          <!-- Left side: th√¥ng tin ƒë∆°n -->
          <div class="d-flex flex-wrap align-items-center gap-3">
            <!-- M√£ ƒë∆°n -->
            üÜî <span th:text="${order.id}" class="fw-bold"></span>

            <!-- ƒê∆°n g·ªëc -->
            <span
              th:if="${order.originalId != null}"
              class="text-muted"
              th:text="'(G·ªëc: ' + ${order.originalId} + ')'"
            ></span>

            <!-- Tr·∫°ng th√°i -->
            <span
              class="badge bg-dark"
              style="font-size: 0.9rem"
              th:text="${order.status}"
            ></span>

            <!-- T·ªïng ti·ªÅn -->
            <span
              class="fw-bold text-primary"
              th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' VND'"
            ></span>

            <!-- Ship fee -->
            <span
              th:text="'Ship: ' + ${#numbers.formatDecimal(order.shipFee, 0, 'COMMA', 0, 'POINT')} + ' VND'"
            ></span>

            <!-- Discount -->
            <span
              class="text-danger"
              th:if="${order.discount != null and order.discount > 0}"
              th:text="'- ' + ${#numbers.formatDecimal(order.discount, 0, 'COMMA', 0, 'POINT')} + ' VND'"
            ></span>
          </div>

          <!-- Right side: COD -->
          <div class="small ms-auto" th:if="${order.paymentMethod=='COD'}">
            üíµ COD
          </div>
        </button>
      </h2>

      <div
        th:id="'order' + ${iterStat.index}"
        class="accordion-collapse collapse"
        data-bs-parent="#orderHistory"
      >
        <div class="accordion-body p-4 bg-white">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th class="text-start">S·∫£n ph·∫©m</th>
                <th>H√¨nh ·∫£nh</th>
                <th>S·ªë l∆∞·ª£ng</th>
                <th>ƒê∆°n gi√°</th>
                <th>Th√†nh ti·ªÅn</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="detail : ${order.orderDetails}" class="align-middle">
                <td class="text-start" th:text="${detail.product.name}"></td>
                <td>
                  <a th:href="@{/detail(id=${detail.product.id})}">
                    <img
                      th:src="@{/images/{image}(image=${detail.product.image_url})}"
                      alt=""
                      width="70px"
                      class="rounded"
                    />
                  </a>
                </td>
                <td th:text="${detail.quantity}" class="text-center"></td>
                <td
                  th:text="${#numbers.formatDecimal(detail.price, 0, 'COMMA', 0, 'POINT')} + ' VND'"
                  class="text-end"
                ></td>
                <td
                  th:text="${#numbers.formatDecimal(detail.price * detail.quantity, 0, 'COMMA', 0, 'POINT')} + ' VND'"
                  class="text-end"
                ></td>
              </tr>
            </tbody>
          </table>
          <div class="card mt-3">
            <div class="card-body p-3">
              <div class="row">
                <!-- Kh·ªëi 1 -->
                <div class="col-md-6">
                  <h6 class="card-title fw-bold text-success mb-2">
                    Th√¥ng tin ng∆∞·ªùi ƒë·∫∑t
                  </h6>
                  <p class="mb-1" th:text="'Name: ' + ${order.user.name}"></p>
                  <p class="mb-0" th:text="'Phone: ' + ${order.user.sdt}"></p>
                </div>

                <!-- Kh·ªëi 2 -->
                <div class="col-md-6">
                  <h6 class="card-title fw-bold text-success mb-2">
                    Th√¥ng tin ng∆∞·ªùi nh·∫≠n
                  </h6>

                  <p
                    class="mb-1"
                    th:text="'Name: ' + ${order.receiverName}"
                  ></p>
                  <p
                    class="mb-0"
                    th:text="'Phone: ' + ${order.receiverPhone}"
                  ></p>
                  <p class="mb-1" th:text="'Address: ' + ${order.address}"></p>
                </div>
              </div>

              <!-- Kh·ªëi 3 (r∆°i xu·ªëng d∆∞·ªõi, chi·∫øm full row) -->
              <div class="row mt-3">
                <!-- Kh·ªëi 1 -->
                <div class="col-md-6">
                  <p
                    class="mb-1"
                    th:text="'M√¥ t·∫£: ' + ${order.description}"
                  ></p>
                  <p>
                    <span
                      th:text="'Ng√†y giao h√†ng: ' + ${#temporals.format(order.deliveryTime, 'HH:mm')}"
                    ></span>
                    <span
                      th:text="${#temporals.format(order.deliveryDate, 'dd/MM/yyyy')}"
                    ></span>
                  </p>

                  <!-- Shipper -->
                  <p
                    class="text-muted"
                    th:text="${order.shipper != null ? 'Shipper: '+order.shipper.name : ''}"
                  ></p>
                  <p
                    class="mb-1"
                    th:text="'Ng√†y ƒë·∫∑t h√†ng: ' + ${#dates.format(order.createDate, 'dd/MM/yyyy')}"
                  >
                    >
                  </p>
                </div>
                <div
                  class="col-md-6"
                  th:if="${order.reason != null and !#strings.isEmpty(order.reason)}"
                >
                  <h6 class="card-title fw-bold text-danger mb-2">L√≠ do:</h6>

                  <p class="mb-1" th:text="${order.reason}"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="d-flex flex-wrap gap-2 m-3">
          <!-- N√∫t X√°c nh·∫≠n -->
          <form
            th:action="@{/orderAdmin/update/{orderId}(orderId=${order.id})}"
            method="post"
            class="update-status-form"
            style="display: inline"
          >
            <input type="hidden" name="status" value="Ch·ªù giao" />
            <button
              type="submit"
              class="btn btn-primary btn-sm"
              th:if="${order.status == 'Ch·ªù x√°c nh·∫≠n'}"
            >
              X√°c nh·∫≠n
            </button>
          </form>

          <!-- N√∫t T·∫°o l·∫°i ƒë∆°n h√†ng -->
          <form
            th:action="@{/orderAdmin/recreate/{orderId}(orderId=${order.id})}"
            method="post"
            style="display: inline"
          >
            <input type="hidden" name="status" value="ƒêang giao l·∫°i" />
            <button
              type="submit"
              class="btn btn-primary btn-sm"
              th:if="${order.status == 'Giao th·∫•t b·∫°i'}"
            >
              T·∫°o l·∫°i ƒë∆°n h√†ng
            </button>
          </form>
          <!-- N√∫t H·ªßy ƒë∆°n -->
          <form
            th:action="@{/orderAdmin/update/{orderId}(orderId=${order.id})}"
            method="post"
            style="display: inline"
          >
            <input type="hidden" name="status" value="H·ªßy ƒë∆°n" />
            <button
              type="submit"
              class="btn btn-danger btn-sm"
              th:if="${order.status == 'Ch·ªù x√°c nh·∫≠n' or order.status == 'Ch·ªù giao' or order.status == 'Giao th·∫•t b·∫°i'}"
            >
              H·ªßy ƒë∆°n
            </button>
          </form>

          <!-- N√∫t Ho√†n t·∫•t ƒë∆°n -->
          <form
            th:action="@{/orderAdmin/update/{orderId}(orderId=${order.id})}"
            method="post"
            style="display: inline"
          >
            <input type="hidden" name="status" value="Ho√†n t·∫•t" />
            <button
              type="submit"
              class="btn btn-success btn-sm"
              th:if="${order.status == 'Giao th·∫•t b·∫°i'}"
              onclick="return confirm('X√°c nh·∫≠n ho√†n t·∫•t ƒë∆°n h√†ng n√†y?')"
            >
              Ho√†n t·∫•t
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <!-- Ph√¢n trang Bootstrap cho orderAdmin -->
  <div class="pagination-wrapper" th:if="${totalOrders > 0}">
    <div class="d-flex justify-content-between align-items-center">
      <div class="pagination-info">
        <i
          >Hi·ªÉn th·ªã
          <strong th:text="${#lists.size(orders.content)}"></strong> trong t·ªïng
          s·ªë <strong th:text="${totalOrders}"></strong> ƒë∆°n h√†ng</i
        >
      </div>

      <nav aria-label="Order pagination" th:if="${totalPages > 1}">
        <ul class="pagination">
          <!-- Trang ƒë·∫ßu -->
          <li
            class="page-item"
            th:classappend="${currentPage == 0} ? 'disabled'"
          >
            <a
              class="page-link"
              th:href="@{/orderAdmin(page=0, size=${size}, orderStatus=${orderStatus}, keyword=${keyword}, fromDate=${fromDate}, toDate=${toDate})}"
              th:unless="${currentPage == 0}"
              title="Trang ƒë·∫ßu"
            >
              <i class="fas fa-angle-double-left"></i>
            </a>
            <span class="page-link" th:if="${currentPage == 0}">
              <i class="fas fa-angle-double-left"></i>
            </span>
          </li>

          <!-- Trang tr∆∞·ªõc -->
          <li class="page-item" th:classappend="${!hasPrevious} ? 'disabled'">
            <a
              class="page-link"
              th:href="@{/orderAdmin(page=${currentPage - 1}, size=${size}, orderStatus=${orderStatus}, keyword=${keyword}, fromDate=${fromDate}, toDate=${toDate})}"
              th:if="${hasPrevious}"
              title="Trang tr∆∞·ªõc"
            >
              <i class="fas fa-chevron-left"></i>
            </a>
            <span class="page-link" th:unless="${hasPrevious}">
              <i class="fas fa-chevron-left"></i>
            </span>
          </li>

          <!-- C√°c trang s·ªë -->
          <li
            class="page-item"
            th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}"
            th:if="${pageNum >= currentPage - 2 and pageNum <= currentPage + 2}"
            th:classappend="${pageNum == currentPage} ? 'active'"
          >
            <a
              class="page-link"
              th:href="@{/orderAdmin(page=${pageNum}, size=${size}, orderStatus=${orderStatus}, keyword=${keyword}, fromDate=${fromDate}, toDate=${toDate})}"
              th:text="${pageNum + 1}"
            ></a>
          </li>

          <!-- Trang sau -->
          <li class="page-item" th:classappend="${!hasNext} ? 'disabled'">
            <a
              class="page-link"
              th:href="@{/orderAdmin(page=${currentPage + 1}, size=${size}, orderStatus=${orderStatus}, keyword=${keyword}, fromDate=${fromDate}, toDate=${toDate})}"
              th:if="${hasNext}"
              title="Trang sau"
            >
              <i class="fas fa-chevron-right"></i>
            </a>
            <span class="page-link" th:unless="${hasNext}">
              <i class="fas fa-chevron-right"></i>
            </span>
          </li>

          <!-- Trang cu·ªëi -->
          <li
            class="page-item"
            th:classappend="${currentPage == totalPages - 1} ? 'disabled'"
          >
            <a
              class="page-link"
              th:href="@{/orderAdmin(page=${totalPages - 1}, size=${size}, orderStatus=${orderStatus}, keyword=${keyword}, fromDate=${fromDate}, toDate=${toDate})}"
              th:unless="${currentPage == totalPages - 1}"
              title="Trang cu·ªëi"
            >
              <i class="fas fa-angle-double-right"></i>
            </a>
            <span class="page-link" th:if="${currentPage == totalPages - 1}">
              <i class="fas fa-angle-double-right"></i>
            </span>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

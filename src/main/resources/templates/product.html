<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sản phẩm</title>
  <link rel="stylesheet" th:href="@{/css/productCategory.css}" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

  <!-- AOS Animate On Scroll -->
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet" />
</head>

<body>
  <div class="container ">
    <div class="d-flex justify-content-between align-items-center flex-wrap">
      <div>
        <th:block th:if="${pro_ca != null}">
          <h2 class="flowers" th:text="${pro_ca.name}"></h2>
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item">
                <a href="/home" class="text-decoration-none text-secondary">Trang chủ</a>
              </li>
              <li class="breadcrumb-item active" aria-current="page">
               <a
                th:href="@{/ProductUser(id=${pro_ca.id})}"
                th:text="${pro_ca.name}"
                class="text-decoration-none"></a>
              </li>
            </ol>
          </nav>
        </th:block>
      </div>
    </div>
    <div class="col row align-items-start">
      <th:block th:if="${pro_ca != null}">
        <aside class="card col-3 bg-light p-3 border-0">
  <form>
    <h3>Lọc sản phẩm</h3>

<!-- Mức gía -->
<div>
  <h4 class="filter-title">Mức Giá</h4>
  <div class="filter-content">
    <ul class="filter-items">
      <li class="filter-item">
        <a th:href="@{/ProductUser(id=${pro_ca.id},min=0,max=200000,categoryId=${selectedCategoryId},color=${selectedColor})}"
           role="button" class="price-range"
           th:classappend="${selectedMin == 0 and selectedMax == 200000} ? ' active-filter'">
          <span>0 - 200.000 VND</span>
        </a>
      </li>
      <li class="filter-item">
        <a th:href="@{/ProductUser(id=${pro_ca.id},min=200000,max=500000,categoryId=${selectedCategoryId},color=${selectedColor})}"
           role="button" class="price-range"
           th:classappend="${selectedMin == 200000 and selectedMax == 500000} ? ' active-filter'">
          <span>200.000 VND - 500.000 VND</span>
        </a>
      </li>
      <li class="filter-item">
        <a th:href="@{/ProductUser(id=${pro_ca.id},min=500000,max=10000000,categoryId=${selectedCategoryId},color=${selectedColor})}"
           role="button" class="price-range"
           th:classappend="${selectedMin == 500000} ? ' active-filter'">
          <span>>=500.000 VND</span>
        </a>
      </li>
    </ul>
  </div>
</div>

<!-- Màu sắc -->
<div>
  <h4 class="filter-title mt-4 mb-4">Màu sắc</h4>
  <div class="d-flex gap-3 flex-wrap">
    <a th:href="@{/ProductUser(id=${pro_ca.id},color=Đỏ,categoryId=${selectedCategoryId},min=${selectedMin},max=${selectedMax})}"
       class="color-link"
       th:classappend="${selectedColor == 'Đỏ'} ? ' active-filter'">
      <span class="color-circle" style="background-color: #ff6961"></span>
    </a>
    <a th:href="@{/ProductUser(id=${pro_ca.id},color=Hồng,categoryId=${selectedCategoryId},min=${selectedMin},max=${selectedMax})}"
       class="color-link"
       th:classappend="${selectedColor == 'Hồng'} ? ' active-filter'">
      <span class="color-circle" style="background-color: #ffb6c1"></span>
    </a>
    <a th:href="@{/ProductUser(id=${pro_ca.id},color=Vàng,categoryId=${selectedCategoryId},min=${selectedMin},max=${selectedMax})}"
       class="color-link"
       th:classappend="${selectedColor == 'Vàng'} ? ' active-filter'">
      <span class="color-circle" style="background-color: #ffeb3b"></span>
    </a>
    <a th:href="@{/ProductUser(id=${pro_ca.id},color='Xanh dương',categoryId=${selectedCategoryId},min=${selectedMin},max=${selectedMax})}"
       class="color-link"
       th:classappend="${selectedColor == 'Xanh dương'} ? ' active-filter'">
      <span class="color-circle" style="background-color: #64b5f6"></span>
    </a>
    <a th:href="@{/ProductUser(id=${pro_ca.id},color=Xanh,categoryId=${selectedCategoryId},min=${selectedMin},max=${selectedMax})}"
       class="color-link"
       th:classappend="${selectedColor == 'Xanh'} ? ' active-filter'">
      <span class="color-circle" style="background-color: #35e67f"></span>
    </a>
    <a th:href="@{/ProductUser(id=${pro_ca.id},color=Trắng,categoryId=${selectedCategoryId},min=${selectedMin},max=${selectedMax})}"
       class="color-link"
       th:classappend="${selectedColor == 'Trắng'} ? ' active-filter'">
      <span class="color-circle" style="background-color: #ffffff; border: 1px solid #ddd"></span>
    </a>
    <a th:href="@{/ProductUser(id=${pro_ca.id},color=Tím,categoryId=${selectedCategoryId},min=${selectedMin},max=${selectedMax})}"
       class="color-link"
       th:classappend="${selectedColor == 'Tím'} ? ' active-filter'">
      <span class="color-circle" style="background-color: #c084fc"></span>
    </a>
    <a th:href="@{/ProductUser(id=${pro_ca.id},color=Cam,categoryId=${selectedCategoryId},min=${selectedMin},max=${selectedMax})}"
       class="color-link"
       th:classappend="${selectedColor == 'Cam'} ? ' active-filter'">
      <span class="color-circle" style="background-color: #f4a261"></span>
    </a>
  </div>
</div>

<!-- Loại hoa -->
<div>
  <h4 class="filter-title mt-4 mb-4">Loại hoa</h4>
  <div class="filter-content">
    <ul class="filter-items">
      <th:block th:each="item:${categogies}">
        <li class="filter-item filter-text mt-2 mb-2">
          <a th:href="@{/ProductUser(id=${pro_ca.id},categoryId=${item.id},color=${selectedColor},min=${selectedMin},max=${selectedMax})}"
             role="button" class="term-label"
             th:classappend="${selectedCategoryId == item.id} ? ' active-filter'"
             th:text="${item.name}"></a>
        </li>
      </th:block>
    </ul>
  </div>
</div>

    
  </form>
</aside>

      </th:block>
      <article th:class="${pro_ca != null} ? 'col-9' : 'col-12'">
          <div class="row">
            <th:block th:each="item:${page.content}">
              <div class="col-md-3 mb-4">
                <div
                  class="card product-card border-0 shadow-sm rounded-4 overflow-hidden text-center"
                >
                  <a
                    th:href="@{/detail(id=${item.id})}"
                    class="text-decoration-none"
                  >
                    <div class="card-img-box">
                      <div class="card-img-inner">
                        <img
                          th:src="@{/images/{image}(image=${item.image_url})}"
                          alt="front"
                          class="card-img card-img-front"
                        />
                        <img
                          th:src="@{/images/{image}(image=${item.image_url})}"
                          alt="back"
                          class="card-img card-img-back"
                        />
                      </div>
                    </div>

                    <div class="card-body p-3">
                      <span
                        class="text-muted small d-block mb-1"
                        th:text="${item.id}"
                      ></span>
                      <h6
                        class="fw-semibold text-dark mb-2"
                        th:text="${item.name}"
                      ></h6>

                      <!-- Có giảm giá đang hoạt động -->
                      <th:block th:if="${item.isDiscountActive()}">
                        <span
                          class="fw-bold text-danger d-block"
                          th:text="${#numbers.formatDecimal(item.getPriceAfterDiscount(), 0, 'COMMA', 0, 'POINT')} + ' VND'"
                        ></span>
                        <span
                          class="text-muted text-decoration-line-through small"
                          th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + ' VND'"
                        ></span>
                      </th:block>

                      <!-- Không có giảm giá hoặc giảm giá đã hết hạn - chỉ hiển thị giá gốc -->
                      <th:block th:if="${!item.isDiscountActive()}">
                        <span
                          class="fw-bold text-muted d-block"
                          th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + ' VND'"
                        ></span>
                      </th:block>
                    </div>
                  </a>
                </div>
              </div>
            </th:block>
          </div>
          <th:block th:if="${pro_ca != null}">
            <div class="container">
              <nav aria-label="Phân trang sản phẩm">
                <ul class="page-numbers nav-pagination links text-center">
                  <li>
                    <a
                      class="btn"
                      th:href="@{/ProductUser(id=${pro_ca.id}, p=0, min=${min}, max=${max}, filter=${filter})}"
                      th:classappend="${page.number == 0} ? 'disabled' : ''"
                      >First</a
                    >
                  </li>
                  <li>
                    <a
                      class="btn"
                      th:href="@{/ProductUser(id=${pro_ca.id}, p=${page.number - 1}, min=${min}, max=${max}, filter=${filter})}"
                      th:classappend="${page.number == 0} ? 'disabled' : ''"
                      ><i class="fas fa-angle-left"></i
                    ></a>
                  </li>
                  <li
                    th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
                  >
                    <a
                      class="btn"
                      th:href="@{/ProductUser(id=${pro_ca.id}, p=${i}, min=${min}, max=${max}, filter=${filter})}"
                      th:classappend="${i == page.number} ? 'active' : ''"
                      th:text="${i + 1}"
                    ></a>
                  </li>
                  <li>
                    <a
                      class="btn"
                      th:href="@{/ProductUser(id=${pro_ca.id}, p=${page.number + 1}, min=${min}, max=${max}, filter=${filter})}"
                      th:classappend="${page.number == page.totalPages - 1} ? 'disabled' : ''"
                      ><i class="fas fa-angle-right"></i
                    ></a>
                  </li>
                  <li>
                    <a
                      class="btn"
                      th:href="@{/ProductUser(id=${pro_ca.id}, p=${page.totalPages - 1}, min=${min}, max=${max}, filter=${filter})}"
                      th:classappend="${page.number == page.totalPages - 1} ? 'disabled' : ''"
                      >Last</a
                    >
                  </li>
                </ul>
              </nav>
            </div>
          </th:block>
          <th:block th:if="${pro_ca == null}">
            <div class="container">
              <nav aria-label="Phân trang tìm kiếm">
                <ul class="page-numbers nav-pagination links text-center">
                  <li>
                    <a
                      class="btn"
                      th:href="@{/search(keyword=${searchKeyword}, p=0)}"
                      th:classappend="${page.number == 0} ? 'disabled' : ''"
                      >First</a
                    >
                  </li>
                  <li>
                    <a
                      class="btn"
                      th:href="@{/search(keyword=${searchKeyword}, p=${page.number - 1})}"
                      th:classappend="${page.number == 0} ? 'disabled' : ''"
                      ><i class="fas fa-angle-left"></i
                    ></a>
                  </li>
                  <li
                    th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
                  >
                    <a
                      class="btn"
                      th:href="@{/search(keyword=${searchKeyword}, p=${i})}"
                      th:classappend="${i == page.number} ? 'active' : ''"
                      th:text="${i + 1}"
                    ></a>
                  </li>
                  <li>
                    <a
                      class="btn"
                      th:href="@{/search(keyword=${searchKeyword}, p=${page.number + 1})}"
                      th:classappend="${page.number == page.totalPages - 1} ? 'disabled' : ''"
                      ><i class="fas fa-angle-right"></i
                    ></a>
                  </li>
                  <li>
                    <a
                      class="btn"
                      th:href="@{/search(keyword=${searchKeyword}, p=${page.totalPages - 1})}"
                      th:classappend="${page.number == page.totalPages - 1} ? 'disabled' : ''"
                      >Last</a
                    >
                  </li>
                </ul>
              </nav>
            </div>
          </th:block>
        </article>
      </div>
      <div class="container">
        
        <div class="row m-4 p-4 g-lg-3">
          <div class="text text-secondary fs-3 mb-2 mt-4">
          Sản phẩm bán chạy nhất
        </div>
          <!-- Card 1 -->
          <th:block
            th:each="product : ${#lists.size(bestsellerProduct) > 8 ? bestsellerProduct.subList(0, 8) : bestsellerProduct}"
          >
            <div class="col-lg-3 col-md-6">
              <div class="product-card">
                <div class="product-img-container">
                  <div class="flip-box">
                    <a
                      th:href="@{/detail(id=${product.id})}"
                      class="text-decoration-none"
                    >
                      <img
                        th:src="@{/images/{image}(image=*{product.image_url})}"
                        class="product-img front-img"
                      />
                      <img
                        th:src="@{/images/{image}(image=*{product.image_url2})}"
                        class="product-img back-img"
                      />
                    </a>
                  </div>

                  <div class="overlay">
                    <form
                      th:action="@{/cart/add}"
                      method="post"
                      style="display: inline"
                    >
                      <div class="add-to-cart-container">
                        <input
                          type="hidden"
                          name="productId"
                          th:value="${product.id}"
                        />
                        <input type="hidden" name="quantity" value="1" />
                        <button class="add-to-cart">
                          <i class="fa fa-shopping-cart"></i>
                        </button>
                        <div class="add-to-cart-text">Add to cart</div>
                      </div>
                    </form>
                  </div>
                </div>

                <div class="product-info">
                  <h4 th:text="${product.name}">Bó hoa cưới</h4>
                  <p th:text="${product.price}">360,000₫</p>
                  <div class="sizes">
                    <form th:action="@{/cart/add}" method="post">
                      <input
                        type="hidden"
                        name="productId"
                        th:value="${product.id}"
                      />
                      <input type="hidden" name="quantity" value="1" />
                      <button type="submit" class="size-btn">Mua ngay</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </th:block>
        </div>
      </div>

<div th:insert="~{/fragments/chatbot}"></div>

    <script th:src="@{/js/services-page.js}"></script>
  </body>
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
  AOS.init();
</script>
<script th:src="@{/js/services-page.js}"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
</html>


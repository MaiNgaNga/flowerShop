<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cửa Hàng Hoa</title>

    <!-- Font Awesome for Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />

    <!-- Style css -->
    <link rel="stylesheet" th:href="@{/css/home.css}" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins&display=swap"
      rel="stylesheet"
    />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Hero Section -->
    <section class="hero-section">
      <div class="hero-overlay"></div>
      <div class="flower-particles" id="flower-particles"></div>
      <div class="hero-content">
        <h1 data-aos="fade-down">Karina Hana</h1>
        <p
          data-aos="fade-up"
          data-aos-delay="200"
          style="
            font-family: 'Poppins', 'Montserrat', 'Lato', Arial, sans-serif;
          "
        >
          Tạo nên những khoảnh khắc đáng nhớ với những thiết kế hoa tinh tế
        </p>
        <a
          th:href="@{/about}"
          class="btn btn-primary"
          data-aos="fade-up"
          data-aos-delay="400"
          >Khám Phá</a
        >
      </div>
    </section>
    <section class="features">
      <div class="feature-item" data-aos="fade-up">
        <img
          th:src="@{/images/Giao-hoa-nhanh-chong.png}"
          alt="Giao hoa nhanh"
          class="mt-4"
        />
        <p class="my-0">Giao hoa nhanh chóng</p>
        <span>Hoa sẽ được giao tới bạn nhanh nhất có thể</span>
      </div>

      <div class="feature-item" data-aos="fade-up" data-aos-delay="100">
        <img
          th:src="@{/images/Chup-hinh-truoc-va-sau-khi-giao.png}"
          alt="Chụp hình trước khi giao"
          class="mt-4"
        />
        <p class="my-0">Chụp Hình Trước & Sau Khi Giao</p>
        <span>Chụp hình hoàn thiện trước và sau khi giao </span>
      </div>

      <div class="feature-item" data-aos="fade-up" data-aos-delay="200">
        <img
          th:src="@{/images/Cam-ket-chat-luong.png}"
          alt="Cam kết chất lượng"
        />
        <p class="my-0">Cam Kết & Chất Lượng</p>
        <span>Hoa đẹp và giống hình 90% so với mẫu </span>
      </div>
    </section>

    <section class="new-flowers-section text-center">
      <h2 class="mb-4" data-aos="fade-up" data-aos-duration="800">
        Sản phẩm mới
      </h2>
      <div class="new-flower-grid-wrapper">
        <div class="new-flower-grid">
          <div
            th:each="product, iterStat : ${latestProducts}"
            class="new-flower-card"
            data-aos="zoom-in-up"
            th:data-aos-delay="${iterStat.index * 100}"
            data-aos-easing="ease-out-back"
          >
            <a
              th:href="@{/detail(id=${product.id})}"
              class="text-decoration-none"
            >
              <img
                th:src="${product.image_url != null and product.image_url != '' ? '/images/' + product.image_url : '/images/logo.png'}"
                th:alt="${product.name}"
                onerror="this.src='/images/logo.png'; this.onerror=null;"
                style="width: 100%; height: 200px; object-fit: cover"
              />
            </a>
            <!-- Hiển thị tên danh mục sản phẩm -->
            <div
              class="product-category-name"
              th:text="${product.productCategory != null ? product.productCategory.name : 'Không có danh mục'}"
              style="
                font-size: 1 rem;
                color: #666;
                margin-bottom: 5px;
                font-weight: 500;
              "
            >
              Danh mục
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="row m-2 my-4 align-items-center">
      <div class="promo-section d-flex flex-wrap align-items-center">
        <!-- PHẦN HÌNH ẢNH -->
        <div
          class="promo-images d-flex flex-wrap gap-3"
          data-aos="fade-right"
          data-aos-duration="1000"
        >
          <div
            class="promo-card"
            th:each="product : ${#lists.size(discountProducts) > 4 ? discountProducts.subList(0, 4) : discountProducts}"
            th:if="${product.discountStart != null
            and T(java.time.LocalDate).now().compareTo(product.discountStart) >= 0
            and (product.productCategory == null or !product.productCategory.name.toLowerCase().contains('phụ kiện'))}"
          >
            <span
              class="promo-tag"
              th:text="'-' + ${product.discountPercent} + '%'"
              >-10%</span
            >
            <a th:href="@{/detail(id=${product.id})}">
              <img
                th:src="${product.image_url != null and product.image_url != '' ? '/images/' + product.image_url : '/images/logo.png'}"
                th:alt="${product.name}"
                alt="Sản phẩm giảm giá"
                onerror="this.src='/images/logo.png'; this.onerror=null;"
              />
            </a>
          </div>
        </div>

        <!-- PHẦN NỘI DUNG -->
        <div
          class="promo-text"
          data-aos="fade-left"
          data-aos-delay="200"
          data-aos-duration="1000"
        >
          <h2>Chọn hoa đẹp – Trao gửi yêu thương trọn vẹn</h2>
          <br />
          <h3>ƯU ĐÃI</h3>
          <p>
            🌸 <strong>Karina Hana Flowers</strong> – Không chỉ là những đóa hoa
            tươi thắm, mà còn là cầu nối để bạn gửi gắm tình yêu thương, sự biết
            ơn và những thông điệp ngọt ngào nhất. <br /><br />
            🌸 Ưu đãi hấp dẫn: Hàng loạt <strong>mã giảm giá</strong> dành riêng
            cho khách hàng thân thiết, ưu đãi đặc biệt trong các dịp lễ lớn và
            chương trình khuyến mãi theo mùa. <br /><br />

            🌸 Hãy để <strong>Karina Hana</strong> đồng hành cùng bạn trong mỗi
            dịp đặc biệt – để từng cánh hoa thay bạn nói lời yêu thương và mang
            đến niềm vui bất ngờ cho người nhận. Theo dõi chúng tôi ngay hôm nay
            để không bỏ lỡ bất kỳ ưu đãi nào! 💐✨
          </p>
        </div>
      </div>
    </section>

    <!-- Phần này có thể đặt trong file dichvu_luoi4.html -->
    <div class="text-center">
      <h2 class="mb-4 fw-bold" data-aos="fade-up" data-aos-duration="800">
        Mã giảm giá
      </h2>
    </div>

    <section
      class="category-cards my-5 d-flex justify-content-center gap-5"
      th:if="${promotionsCode != null and !promotionsCode.isEmpty()}"
    >
      <div class="image-grid">
        <th:block
          th:each="promotions : ${#lists.size(promotionsCode) > 3 ? promotionsCode.subList(0, 3) : promotionsCode}"
        >
          <div
            class="image-card"
            data-aos="zoom-in"
            data-aos-delay="0"
            data-aos-duration="800"
          >
            <img
              src="https://images.unsplash.com/photo-1554388450-b06c82abd505?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTUwfHxmbG93ZXJ8ZW58MHx8MHx8fDA%3D"
              alt="Ảnh 1"
            />

            <div class="always-show-content centered">
              <div class="code-banner">
                <p class="code-label">🎁 Tặng bạn mã:</p>
                <div th:text="${promotions.title}" class="code-box">M30</div>
                <p th:text="${promotions.description}" class="code-description">
                  🎉 Nhập mã để được giảm ngay <strong>50K</strong>
                </p>
              </div>
            </div>
          </div>
        </th:block>
      </div>
    </section>

    <section class="best-seller-section" data-aos="fade-in" data-aos-delay="0">
      <h2 data-aos="fade-in" data-aos-delay="100">Best Seller</h2>
      <div>
        <button
          class="filter-btn active"
          data-aos="fade-in"
          data-aos-delay="200"
          data-type="lang"
        >
          Lãng hoa
        </button>
        <button
          class="filter-btn"
          data-aos="fade-in"
          data-aos-delay="200"
          data-type="gio"
        >
          Giỏ hoa
        </button>
        <button
          class="filter-btn"
          data-aos="fade-in"
          data-aos-delay="200"
          data-type="bo"
        >
          Bó hoa
        </button>
      </div>

      <div
        id="best-seller-grid"
        class="product-grid"
        data-aos="fade-in"
        data-aos-delay="200"
      >
        <!-- Dynamic products loaded from database -->
        <div
          th:each="product, iterStat : ${defaultBestSeller}"
          class="product-card"
          data-aos="fade-in"
          th:data-aos-delay="${300 + iterStat.index * 100}"
        >
          <div class="product-image">
            <a
              th:href="@{/detail(id=${product.id})}"
              class="text-decoration-none"
            >
              <img
                th:src="${product.image_url != null and product.image_url != '' ? '/images/' + product.image_url : '/images/logo.png'}"
                class="default-img"
                th:alt="${product.name}"
                onerror="this.src='/images/logo.png'; this.onerror=null;"
              />
              <img
                th:src="${product.image_url2 != null and product.image_url2 != '' ? '/images/' + product.image_url2 : '/images/logo.png'}"
                class="hover-img"
                th:alt="${product.name}"
                onerror="this.src='/images/logo.png'; this.onerror=null;"
              />
            </a>
            <form
              th:action="@{/cart/add}"
              method="post"
              style="display: inline"
            >
              <input type="hidden" name="productId" th:value="${product.id}" />
              <input type="hidden" name="quantity" value="1" />
              <button
                type="submit"
                class="cart-icon-wrapper"
                style="border: none; background: none; padding: 0"
              >
                <div class="cart-icon">
                  <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="add-to-cart-text">Add To Cart</div>
              </button>
            </form>
          </div>
          <div class="product-info">
            <div class="product-name" th:text="${product.name}">
              Tên sản phẩm
            </div>
            <!-- Nếu đang trong thời gian giảm giá -->
            <div
              class="product-price"
              th:if="${product.discountPercent != null && product.discountPercent > 0
                && product.discountStart != null
                && T(java.time.LocalDate).now().compareTo(product.discountStart) >= 0
                && (product.discountEnd == null or T(java.time.LocalDate).now().compareTo(product.discountEnd) <= 0)}"
              style="display: flex; flex-direction: column; align-items: center"
            >
              <span
                class="discounted-price"
                th:text="${#numbers.formatDecimal(product.priceAfterDiscount, 0, 'COMMA', 0, 'POINT')} + '₫'"
              ></span>
              <span
                class="original-price"
                style="margin-top: 2px"
                th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + '₫'"
              ></span>
            </div>
            <!-- Nếu chưa tới ngày giảm giá hoặc không có giảm giá -->
            <div
              class="product-price"
              th:if="${product.discountPercent == null || product.discountPercent <= 0
                || product.discountStart == null
                || T(java.time.LocalDate).now().compareTo(product.discountStart) < 0
                || (product.discountEnd != null && T(java.time.LocalDate).now().compareTo(product.discountEnd) > 0)}"
              th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + '₫'"
            >
              Giá sản phẩm
            </div>
          </div>
        </div>
      </div>
    </section>

    <section
      class="post-slider-section"
      data-aos="fade-up"
      data-aos-duration="800"
    >
      <h2 class="section-title" data-aos="fade-right" data-aos-delay="100">
        Bài viết
      </h2>
      <div class="swiper post-slider">
        <div class="swiper-wrapper">
          <div class="swiper-slide" th:each="post : ${posts}">
            <img
              th:src="${post.image != null && post.image != '' ? '/images/' + post.image : '/images/logo.png'}"
              alt="Ảnh bài viết"
              class="avatar-img"
              style="object-fit: cover"
              onerror="this.src='/images/logo.png'; this.onerror=null;"
            />
            <div class="post-content">
              <h5 th:text="${post.title}">Tiêu đề</h5>
              <span th:utext="${post.summary}"></span>
              <div
                class="d-flex justify-content-between align-items-center mt-2"
              >
                <small class="text-muted"
                  ><i class="fa fa-calendar"></i>
                  <span
                    th:text="${#temporals.format(post.postDate,'dd/MM/yyyy')}"
                    >01/01/25</span
                  ></small
                >
                <a th:href="@{/postDetail(id=${post.id})}" class="read-more-btn"
                  >Xem chi tiết</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="accessory-section">
      <h2>Phụ kiện</h2>
      <div class="product-grid" data-aos="fade-in" data-aos-delay="200">
        <div
          class="product-card"
          th:each="product, iterStat : ${top10PhuKien}"
          data-aos="fade-in"
          th:data-aos-delay="${300 + iterStat.index * 100}"
        >
          <div class="product-image">
            <a
              th:href="@{/detail(id=${product.id})}"
              class="text-decoration-none"
            >
              <img
                th:src="${product.image_url != null and product.image_url != '' ? '/images/' + product.image_url : '/images/logo.png'}"
                class="default-img"
                th:alt="${product.name}"
                onerror="this.src='/images/logo.png'; this.onerror=null;"
              />
              <img
                th:src="${product.image_url2 != null and product.image_url2 != '' ? '/images/' + product.image_url2 : '/images/logo.png'}"
                class="hover-img"
                th:alt="${product.name}"
                onerror="this.src='/images/logo.png'; this.onerror=null;"
              />
            </a>
            <form
              th:action="@{/cart/add}"
              method="post"
              style="display: inline"
            >
              <input type="hidden" name="productId" th:value="${product.id}" />
              <input type="hidden" name="quantity" value="1" />
              <button
                type="submit"
                class="cart-icon-wrapper"
                style="border: none; background: none; padding: 0"
              >
                <div class="cart-icon">
                  <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="add-to-cart-text">Add To Cart</div>
              </button>
            </form>
          </div>
          <div class="product-info">
            <div class="product-name" th:text="${product.name}">
              Tên sản phẩm
            </div>
            <!-- Nếu đang trong thời gian giảm giá -->
            <div
              class="product-price"
              th:if="${product.discountPercent != null && product.discountPercent > 0
                && product.discountStart != null
                && T(java.time.LocalDate).now().compareTo(product.discountStart) >= 0
                && (product.discountEnd == null or T(java.time.LocalDate).now().compareTo(product.discountEnd) <= 0)}"
              style="display: flex; flex-direction: column; align-items: center"
            >
              <span
                class="discounted-price"
                th:text="${#numbers.formatDecimal(product.priceAfterDiscount, 0, 'COMMA', 0, 'POINT')} + '₫'"
              ></span>
              <span
                class="original-price"
                th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + '₫'"
              ></span>
            </div>
            <!-- Nếu chưa tới ngày giảm giá hoặc không có giảm giá -->
            <div
              class="product-price"
              th:if="${product.discountPercent == null || product.discountPercent <= 0
                || product.discountStart == null
                || T(java.time.LocalDate).now().compareTo(product.discountStart) < 0
                || (product.discountEnd != null && T(java.time.LocalDate).now().compareTo(product.discountEnd) > 0)}"
              th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + '₫'"
            >
              Giá sản phẩm
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Đặt trong file home.html, ngay sau section Best Seller -->
    <section
      class="testimonials-section"
      data-aos="fade-up"
      data-aos-duration="800"
    >
      <div class="container">
        <h2 class="section-title" data-aos="fade-right" data-aos-delay="100">
          Đánh Giá Từ Khách Hàng
        </h2>
        <div class="testimonials-grid">
          <div
            th:each="comment, iterStat : ${comments}"
            class="testimonial-card"
            data-aos="fade-up"
            th:data-aos-delay="${iterStat.index * 100}"
          >
            <div class="rating">
              <span
                th:each="i : ${#numbers.sequence(1, 5)}"
                th:class="${i <= comment.rating} ? 'star filled fas fa-star' : 'star fas fa-star'"
                th:classappend="${i <= comment.rating} ? 'filled' : ''"
              ></span>
            </div>

            <h3 class="user-name" th:text="${comment.user.name}">
              Tên người dùng
            </h3>
            <p class="user-comment" th:text="${comment.content}">
              Nội dung bình luận
            </p>
          </div>
        </div>
      </div>
    </section>

    <section
      class="service-section"
      data-aos="fade-up"
      data-aos-duration="1000"
    >
      <div class="service-container">
        <!-- Hình ảnh trình chiếu -->
        <div class="service-carousel" data-aos="zoom-in" data-aos-delay="100">
          <div class="carousel-images">
            <th:block th:each="service, iterStat : ${latestServices}">
              <img
                th:src="@{/images/{image}(image=${service.image_url})}"
                th:alt="${service.name}"
                th:class="${iterStat.index == 0} ? 'carousel-img active' : 'carousel-img'"
              />
              <img
                th:src="@{/images/{image}(image=${service.image_url2})}"
                th:alt="${service.name}"
                class="carousel-img"
              />
              <img
                th:src="@{/images/{image}(image=${service.image_url3})}"
                th:alt="${service.name}"
                class="carousel-img"
              />
            </th:block>
          </div>
        </div>
        <!-- Nội dung dịch vụ -->
        <div class="service-content" data-aos="fade-left" data-aos-delay="300">
          <h2>Dịch vụ</h2>

          <!-- Hiển thị dịch vụ mới nhất có trạng thái hoạt động -->
          <div th:if="${latestServices != null and !latestServices.empty}">
            <div th:each="service : ${latestServices}">
              <p>
                <strong th:text="${service.name}">Tên dịch vụ</strong><br />
                <span th:text="${service.description}">Mô tả dịch vụ</span>
              </p>
            </div>
          </div>

          <!-- Fallback nếu không có dịch vụ -->
          <div th:if="${latestServices == null or latestServices.empty}">
            <p>
              <strong>Karina Hana shop</strong> là một trong những tiệm hoa tươi
              uy tín nhất tại Đà Nẵng, Việt Nam. Karina Hana cung cấp dịch vụ
              đặt hoa online giao tận nơi toàn quốc, với chất lượng cao, giá tốt
              và phục vụ tận tâm.<br /><br />
              Gửi tặng yêu thương thật dễ dàng cùng Karina Hana shop – nơi mỗi
              bó hoa là một câu chuyện.
            </p>
          </div>

          <a th:href="@{/services}" class="service-button"
            ><span>Xem tất cả</span></a
          >
        </div>
      </div>
    </section>
    <div th:insert="~{/fragments/chatbot}"></div>
    <script th:src="@{/js/home-page.js}"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
    <!-- Modal thêm vào giỏ hàng thành công -->
    <div
      th:replace="~{fragments/cart-success-modal :: #cartSuccessModal}"
    ></div>
  </body>
</html>
